<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plot Voting App</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Google Sheets Configuration
        const SHEETS_CONFIG = {
            apiKey: 'AIzaSyCZ9CZThBs7qxr9Yr9q5pfiqMdqwI_gJCY',
            spreadsheetId: '1tn0vdg--f4Xtc6aJZ9vl7wJiEOW0c9P841kzKxEN8NQ',
            range: 'Votes!A:F',
            appsScriptUrl: 'https://script.google.com/macros/s/AKfycbxQ0R6lDms0dAa7Qxu7SNYw_Yoidsm-P6iN2UCj1v4PGXbPxe8t_zs0e8dYuHy43yLJ9Q/exec'
        };

        // Lucide icons as inline SVG components
        const ThumbsUp = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3zM7 22H4a2 2 0 01-2-2v-7a2 2 0 012-2h3" />
            </svg>
        );

        const ThumbsDown = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 15v4a3 3 0 003 3l4-9V2H5.72a2 2 0 00-2 1.7l-1.38 9a2 2 0 002 2.3zm7-13h2.67A2.31 2.31 0 0122 4v7a2.31 2.31 0 01-2.33 2H17" />
            </svg>
        );

        const SkipForward = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} points="5 4 15 12 5 20 5 4" />
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="19" y1="5" x2="19" y2="19" />
            </svg>
        );

        const BarChart3 = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="18" y1="20" x2="18" y2="10" />
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="12" y1="20" x2="12" y2="4" />
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="6" y1="20" x2="6" y2="14" />
            </svg>
        );

        const User = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" />
                <circle strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} cx="12" cy="7" r="4" />
            </svg>
        );

        const Settings = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} cx="12" cy="12" r="3" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 1v6m0 6v6m5.66-13.66l-4.24 4.24m0 6l-4.24 4.24m13.66-5.66l-6 0m-6 0l-6 0m13.66 5.66l-4.24-4.24m0-6l-4.24-4.24" />
            </svg>
        );

        const ExternalLink = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3" />
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} points="23 4 23 10 17 10" />
                <polyline strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} points="1 20 1 14 7 14" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15" />
            </svg>
        );

        const ZoomIn = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} cx="11" cy="11" r="8" />
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="21" y1="21" x2="16.65" y2="16.65" />
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="11" y1="8" x2="11" y2="14" />
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="8" y1="11" x2="14" y2="11" />
            </svg>
        );

        const ZoomOut = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} cx="11" cy="11" r="8" />
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="21" y1="21" x2="16.65" y2="16.65" />
                <line strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} x1="8" y1="11" x2="14" y2="11" />
            </svg>
        );

        const Maximize = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" />
            </svg>
        );

        function PlotVotingApp() {
            const [plots, setPlots] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [loading, setLoading] = useState(true);
            const [userName, setUserName] = useState('');
            const [isNameSet, setIsNameSet] = useState(false);
            const [showStats, setShowStats] = useState(false);
            const [showSettings, setShowSettings] = useState(false);
            const [imageBasePath, setImageBasePath] = useState('');
            const [tempBasePath, setTempBasePath] = useState('');
            const [sheetsConfigured, setSheetsConfigured] = useState(false);
            const [loadError, setLoadError] = useState('');
            const [saving, setSaving] = useState(false);
            const [lastSync, setLastSync] = useState(null);
            const [imageZoom, setImageZoom] = useState(1);
            const [imagePosition, setImagePosition] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });

            useEffect(() => {
                checkSheetsConfig();
            }, []);

            const checkSheetsConfig = () => {
                const configured = SHEETS_CONFIG.apiKey !== 'YOUR_API_KEY_HERE' && 
                                 SHEETS_CONFIG.spreadsheetId !== 'YOUR_SPREADSHEET_ID_HERE';
                setSheetsConfigured(configured);
                
                if (configured) {
                    loadData();
                } else {
                    setLoading(false);
                    setLoadError('Google Sheets not configured. Please follow setup instructions.');
                }
            };

            const loadData = async () => {
                try {
                    setLoadError('');
                    const response = await fetch(
                        `https://sheets.googleapis.com/v4/spreadsheets/${SHEETS_CONFIG.spreadsheetId}/values/${SHEETS_CONFIG.range}?key=${SHEETS_CONFIG.apiKey}`
                    );

                    if (!response.ok) {
                        throw new Error(`Failed to load data: ${response.statusText}`);
                    }

                    const data = await response.json();
                    
                    // Initialize plots array
                    const plotsMap = {};
                    for (let i = 1; i <= 1000; i++) {
                        plotsMap[i] = {
                            id: i,
                            filename: `plot_${String(i).padStart(4, '0')}`,
                            votes: { yes: [], no: [] }
                        };
                    }

                    // Parse votes from sheet (skip header row)
                    if (data.values && data.values.length > 1) {
                        for (let i = 1; i < data.values.length; i++) {
                            const row = data.values[i];
                            const plotId = parseInt(row[0]);
                            const voter = row[1];
                            const vote = row[2];
                            
                            if (plotsMap[plotId] && voter && vote) {
                                if (vote.toLowerCase() === 'yes') {
                                    plotsMap[plotId].votes.yes.push(voter);
                                } else if (vote.toLowerCase() === 'no') {
                                    plotsMap[plotId].votes.no.push(voter);
                                }
                            }
                        }
                    }

                    setPlots(Object.values(plotsMap));
                    setLastSync(new Date());
                    
                    // Load image path from localStorage
                    const savedPath = localStorage.getItem('image-base-path');
                    if (savedPath) {
                        setImageBasePath(savedPath);
                        setTempBasePath(savedPath);
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    setLoadError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            const saveImagePath = () => {
                localStorage.setItem('image-base-path', tempBasePath);
                setImageBasePath(tempBasePath);
                setShowSettings(false);
            };

            const saveVote = async (vote) => {
                if (!userName || !sheetsConfigured) return;

                setSaving(true);
                try {
                    const plot = plots[currentIndex];
                    
                    // Prepare the data to append
                    const timestamp = new Date().toISOString();
                    const rowData = [
                        plot.id,
                        userName,
                        vote === 'yes' ? 'Yes' : vote === 'no' ? 'No' : 'Skip',
                        plot.filename,
                        timestamp,
                        `https://docs.google.com/spreadsheets/d/${SHEETS_CONFIG.spreadsheetId}/edit`
                    ];

                    // Append to Google Sheets
                    const response = await fetch(
                        `https://sheets.googleapis.com/v4/spreadsheets/${SHEETS_CONFIG.spreadsheetId}/values/${SHEETS_CONFIG.range}:append?valueInputOption=RAW&key=${SHEETS_CONFIG.apiKey}`,
                        {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                values: [rowData]
                            })
                        }
                    );

                    if (!response.ok) {
                        throw new Error('Failed to save vote');
                    }

                    // Update local state
                    const updatedPlots = [...plots];
                    const currentPlot = updatedPlots[currentIndex];
                    
                    currentPlot.votes.yes = currentPlot.votes.yes.filter(v => v !== userName);
                    currentPlot.votes.no = currentPlot.votes.no.filter(v => v !== userName);
                    
                    if (vote === 'yes') {
                        currentPlot.votes.yes.push(userName);
                    } else if (vote === 'no') {
                        currentPlot.votes.no.push(userName);
                    }

                    setPlots(updatedPlots);

                    // Move to next plot
                    if (currentIndex < plots.length - 1) {
                        setCurrentIndex(currentIndex + 1);
                    }
                } catch (error) {
                    console.error('Error saving vote:', error);
                    alert('Failed to save vote. Please try again.');
                } finally {
                    setSaving(false);
                }
            };

            const goToPlot = (index) => {
                if (index >= 0 && index < plots.length) {
                    setCurrentIndex(index);
                    // Reset zoom when changing plots
                    setImageZoom(1);
                    setImagePosition({ x: 0, y: 0 });
                }
            };

            const getCurrentVote = () => {
                if (!plots[currentIndex] || !userName) return null;
                const plot = plots[currentIndex];
                if (plot.votes.yes.includes(userName)) return 'yes';
                if (plot.votes.no.includes(userName)) return 'no';
                return null;
            };

            const getStats = () => {
                const totalVotes = plots.reduce((sum, plot) => 
                    sum + plot.votes.yes.length + plot.votes.no.length, 0
                );
                const yesVotes = plots.reduce((sum, plot) => sum + plot.votes.yes.length, 0);
                const noVotes = plots.reduce((sum, plot) => sum + plot.votes.no.length, 0);
                const votedPlots = plots.filter(plot => 
                    plot.votes.yes.length > 0 || plot.votes.no.length > 0
                ).length;
                
                return { totalVotes, yesVotes, noVotes, votedPlots };
            };

            const openGoogleSheet = () => {
                window.open(`https://docs.google.com/spreadsheets/d/${SHEETS_CONFIG.spreadsheetId}/edit`, '_blank');
            };

            const handleWheel = (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                setImageZoom(prev => Math.min(Math.max(0.5, prev * delta), 5));
            };

            const handleMouseDown = (e) => {
                if (imageZoom > 1) {
                    setIsDragging(true);
                    setDragStart({ x: e.clientX - imagePosition.x, y: e.clientY - imagePosition.y });
                }
            };

            const handleMouseMove = (e) => {
                if (isDragging) {
                    setImagePosition({
                        x: e.clientX - dragStart.x,
                        y: e.clientY - dragStart.y
                    });
                }
            };

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            const resetZoom = () => {
                setImageZoom(1);
                setImagePosition({ x: 0, y: 0 });
            };

            const zoomIn = () => {
                setImageZoom(prev => Math.min(prev * 1.2, 5));
            };

            const zoomOut = () => {
                setImageZoom(prev => Math.max(prev / 1.2, 0.5));
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                        <div className="text-xl text-gray-600">Loading...</div>
                    </div>
                );
            }

            if (!sheetsConfigured || loadError) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full">
                            <h1 className="text-2xl font-bold text-gray-800 mb-4">Setup Required</h1>
                            <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                <p className="text-yellow-800">{loadError || 'Google Sheets not configured'}</p>
                            </div>
                            <div className="space-y-4 text-gray-700">
                                <p className="font-semibold">Follow these steps to set up Google Sheets:</p>
                                <ol className="list-decimal list-inside space-y-2 ml-4">
                                    <li>Create a new Google Sheet with these columns in row 1:
                                        <div className="bg-gray-50 p-2 rounded mt-1 font-mono text-sm">
                                            Plot_ID | Voter | Vote | Filename | Timestamp | Sheet_URL
                                        </div>
                                    </li>
                                    <li>Go to Google Cloud Console and enable Google Sheets API</li>
                                    <li>Create an API key with Sheets API access</li>
                                    <li>Copy your Sheet ID from the URL</li>
                                    <li>Edit the HTML file and update SHEETS_CONFIG at the top</li>
                                </ol>
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
                                    <p className="text-sm text-blue-800">
                                        See the full setup guide in the instructions below.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (!isNameSet) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full">
                            <div className="flex items-center justify-center mb-6">
                                <User className="w-12 h-12 text-indigo-600" />
                            </div>
                            <h1 className="text-2xl font-bold text-gray-800 mb-4 text-center">
                                Plot Image Voting
                            </h1>
                            <p className="text-gray-600 mb-6 text-center">
                                Enter your name to start voting on plots
                            </p>
                            <input
                                type="text"
                                value={userName}
                                onChange={(e) => setUserName(e.target.value)}
                                placeholder="Your name"
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent mb-4"
                                onKeyPress={(e) => {
                                    if (e.key === 'Enter' && userName.trim()) {
                                        setIsNameSet(true);
                                    }
                                }}
                            />
                            <button
                                onClick={() => userName.trim() && setIsNameSet(true)}
                                className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                            >
                                Start Voting
                            </button>
                        </div>
                    </div>
                );
            }

            const currentPlot = plots[currentIndex];
            const currentVote = getCurrentVote();
            const stats = getStats();
            const imageUrl = imageBasePath ? `${imageBasePath}/${currentPlot.filename}` : '';

            if (showSettings) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-xl p-8">
                                <h2 className="text-3xl font-bold text-gray-800 mb-6">Settings</h2>
                                
                                <div className="space-y-6">
                                    <div>
                                        <h3 className="text-xl font-semibold mb-4">Image Base Path</h3>
                                        <p className="text-gray-600 mb-4">
                                            Enter the base URL where your plot images are hosted.
                                        </p>
                                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                            <p className="text-sm text-blue-800 font-mono break-all">
                                                ./plots
                                            </p>
                                            <p className="text-xs text-blue-600 mt-2">
                                                (or use full URL: https://username.github.io/repo-name/plots)
                                            </p>
                                        </div>
                                        <input
                                            type="text"
                                            value={tempBasePath}
                                            onChange={(e) => setTempBasePath(e.target.value)}
                                            placeholder="./plots"
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent mb-4"
                                        />
                                    </div>

                                    <div>
                                        <h3 className="text-xl font-semibold mb-4">Google Sheets</h3>
                                        <button
                                            onClick={openGoogleSheet}
                                            className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                                        >
                                            <ExternalLink className="w-4 h-4" />
                                            Open Voting Sheet
                                        </button>
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={saveImagePath}
                                            className="flex-1 bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                                        >
                                            Save Settings
                                        </button>
                                        <button
                                            onClick={() => {
                                                setTempBasePath(imageBasePath);
                                                setShowSettings(false);
                                            }}
                                            className="flex-1 bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors font-medium"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (showStats) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-xl p-8">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-3xl font-bold text-gray-800">Voting Statistics</h2>
                                    <button
                                        onClick={loadData}
                                        className="flex items-center gap-2 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors"
                                    >
                                        <RefreshCw className="w-4 h-4" />
                                        Refresh
                                    </button>
                                </div>
                                
                                {lastSync && (
                                    <p className="text-sm text-gray-500 mb-4">
                                        Last synced: {lastSync.toLocaleTimeString()}
                                    </p>
                                )}

                                <div className="grid grid-cols-2 gap-4 mb-8">
                                    <div className="bg-green-50 p-6 rounded-lg">
                                        <div className="text-green-600 text-4xl font-bold">{stats.yesVotes}</div>
                                        <div className="text-gray-600 mt-2">Yes Votes</div>
                                    </div>
                                    <div className="bg-red-50 p-6 rounded-lg">
                                        <div className="text-red-600 text-4xl font-bold">{stats.noVotes}</div>
                                        <div className="text-gray-600 mt-2">No Votes</div>
                                    </div>
                                    <div className="bg-blue-50 p-6 rounded-lg">
                                        <div className="text-blue-600 text-4xl font-bold">{stats.votedPlots}</div>
                                        <div className="text-gray-600 mt-2">Plots with Votes</div>
                                    </div>
                                    <div className="bg-purple-50 p-6 rounded-lg">
                                        <div className="text-purple-600 text-4xl font-bold">{stats.totalVotes}</div>
                                        <div className="text-gray-600 mt-2">Total Votes</div>
                                    </div>
                                </div>

                                <div className="mb-6">
                                    <button
                                        onClick={openGoogleSheet}
                                        className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
                                    >
                                        <ExternalLink className="w-4 h-4" />
                                        View Full Data in Google Sheets
                                    </button>
                                </div>

                                <div className="mb-6">
                                    <h3 className="text-xl font-semibold mb-4">Plot Summary</h3>
                                    <div className="max-h-96 overflow-y-auto">
                                        {plots.slice(0, 50).map((plot) => {
                                            const hasVotes = plot.votes.yes.length > 0 || plot.votes.no.length > 0;
                                            if (!hasVotes) return null;
                                            
                                            return (
                                                <div key={plot.id} className="border-b py-3 flex justify-between items-center">
                                                    <span className="font-medium">{plot.filename}</span>
                                                    <div className="flex gap-4">
                                                        <span className="text-green-600">✓ {plot.votes.yes.length}</span>
                                                        <span className="text-red-600">✗ {plot.votes.no.length}</span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <p className="text-sm text-gray-500 mt-4">
                                        Showing first 50 plots with votes. View all data in Google Sheets.
                                    </p>
                                </div>

                                <button
                                    onClick={() => setShowStats(false)}
                                    className="w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                                >
                                    Back to Voting
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-5xl mx-auto">
                        <div className="bg-white rounded-lg shadow-xl p-8 mb-4">
                            <div className="flex justify-between items-center mb-6">
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-800">Plot {currentPlot.id} of {plots.length}</h1>
                                    <p className="text-gray-600">Voting as: {userName}</p>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={loadData}
                                        disabled={saving}
                                        className="flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50"
                                    >
                                        <RefreshCw className="w-5 h-5" />
                                        Sync
                                    </button>
                                    <button
                                        onClick={() => setShowSettings(true)}
                                        className="flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                                    >
                                        <Settings className="w-5 h-5" />
                                    </button>
                                    <button
                                        onClick={() => setShowStats(true)}
                                        className="flex items-center gap-2 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition-colors"
                                    >
                                        <BarChart3 className="w-5 h-5" />
                                        Stats
                                    </button>
                                </div>
                            </div>

                            <div 
                                className="bg-gray-50 rounded-lg mb-6 relative overflow-hidden"
                                style={{ height: '600px' }}
                                onWheel={handleWheel}
                            >
                                {imageUrl ? (
                                    <>
                                        <div 
                                            className="w-full h-full flex items-center justify-center"
                                            onMouseDown={handleMouseDown}
                                            onMouseMove={handleMouseMove}
                                            onMouseUp={handleMouseUp}
                                            onMouseLeave={handleMouseUp}
                                            style={{ cursor: imageZoom > 1 ? (isDragging ? 'grabbing' : 'grab') : 'default' }}
                                        >
                                            <img 
                                                src={imageUrl} 
                                                alt={`Plot ${currentPlot.id}`}
                                                className="select-none"
                                                style={{
                                                    maxWidth: '100%',
                                                    maxHeight: '100%',
                                                    objectFit: 'contain',
                                                    transform: `scale(${imageZoom}) translate(${imagePosition.x / imageZoom}px, ${imagePosition.y / imageZoom}px)`,
                                                    transition: isDragging ? 'none' : 'transform 0.1s ease-out'
                                                }}
                                                onError={(e) => {
                                                    e.target.style.display = 'none';
                                                }}
                                                draggable={false}
                                            />
                                        </div>
                                        <div className="absolute top-4 right-4 flex flex-col gap-2">
                                            <button
                                                onClick={zoomIn}
                                                className="p-2 bg-white bg-opacity-90 rounded-lg shadow-lg hover:bg-opacity-100 transition-all"
                                                title="Zoom In"
                                            >
                                                <ZoomIn className="w-5 h-5 text-gray-700" />
                                            </button>
                                            <button
                                                onClick={zoomOut}
                                                className="p-2 bg-white bg-opacity-90 rounded-lg shadow-lg hover:bg-opacity-100 transition-all"
                                                title="Zoom Out"
                                            >
                                                <ZoomOut className="w-5 h-5 text-gray-700" />
                                            </button>
                                            <button
                                                onClick={resetZoom}
                                                className="p-2 bg-white bg-opacity-90 rounded-lg shadow-lg hover:bg-opacity-100 transition-all"
                                                title="Reset Zoom"
                                            >
                                                <Maximize className="w-5 h-5 text-gray-700" />
                                            </button>
                                        </div>
                                        {imageZoom !== 1 && (
                                            <div className="absolute bottom-4 right-4 px-3 py-1 bg-white bg-opacity-90 rounded-lg shadow-lg text-sm font-medium">
                                                {Math.round(imageZoom * 100)}%
                                            </div>
                                        )}
                                    </>
                                ) : (
                                    <div className="w-full h-full flex items-center justify-center text-center text-gray-500">
                                        <div>
                                            <p className="mb-4">No image path configured</p>
                                            <button
                                                onClick={() => setShowSettings(true)}
                                                className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                                            >
                                                Configure in Settings
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="mb-6">
                                <div className="text-sm text-gray-600 mb-2">
                                    <span className="font-medium">{currentPlot.filename}</span>
                                    <span className="mx-2">•</span>
                                    Current votes: {currentPlot.votes.yes.length} Yes, {currentPlot.votes.no.length} No
                                </div>
                                {currentVote && (
                                    <div className="text-sm font-medium text-indigo-600">
                                        Your vote: {currentVote === 'yes' ? 'Yes ✓' : 'No ✗'}
                                    </div>
                                )}
                            </div>

                            <div className="flex gap-4 mb-6">
                                <button
                                    onClick={() => saveVote('yes')}
                                    disabled={saving}
                                    className={`flex-1 flex items-center justify-center gap-2 py-4 rounded-lg font-medium transition-colors disabled:opacity-50 ${
                                        currentVote === 'yes'
                                            ? 'bg-green-600 text-white'
                                            : 'bg-green-100 text-green-700 hover:bg-green-200'
                                    }`}
                                >
                                    <ThumbsUp className="w-5 h-5" />
                                    Include
                                </button>
                                <button
                                    onClick={() => saveVote('no')}
                                    disabled={saving}
                                    className={`flex-1 flex items-center justify-center gap-2 py-4 rounded-lg font-medium transition-colors disabled:opacity-50 ${
                                        currentVote === 'no'
                                            ? 'bg-red-600 text-white'
                                            : 'bg-red-100 text-red-700 hover:bg-red-200'
                                    }`}
                                >
                                    <ThumbsDown className="w-5 h-5" />
                                    Exclude
                                </button>
                                <button
                                    onClick={() => saveVote('skip')}
                                    disabled={saving}
                                    className="flex-1 flex items-center justify-center gap-2 py-4 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 font-medium transition-colors disabled:opacity-50"
                                >
                                    <SkipForward className="w-5 h-5" />
                                    Skip
                                </button>
                            </div>

                            <div className="flex gap-2">
                                <button
                                    onClick={() => goToPlot(currentIndex - 1)}
                                    disabled={currentIndex === 0}
                                    className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    Previous
                                </button>
                                <input
                                    type="number"
                                    min="1"
                                    max={plots.length}
                                    value={currentIndex + 1}
                                    onChange={(e) => {
                                        const val = parseInt(e.target.value) - 1;
                                        if (!isNaN(val)) goToPlot(val);
                                    }}
                                    className="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-center"
                                />
                                <button
                                    onClick={() => goToPlot(currentIndex + 1)}
                                    disabled={currentIndex === plots.length - 1}
                                    className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    Next
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-xl p-4">
                            <div className="w-full bg-gray-200 rounded-full h-2">
                                <div
                                    className="bg-indigo-600 h-2 rounded-full transition-all"
                                    style={{ width: `${((currentIndex + 1) / plots.length) * 100}%` }}
                                />
                            </div>
                            <p className="text-center text-sm text-gray-600 mt-2">
                                Progress: {currentIndex + 1} / {plots.length}
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<PlotVotingApp />, document.getElementById('root'));
    </script>
</body>
</html>